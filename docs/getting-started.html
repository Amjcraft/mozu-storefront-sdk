
<!DOCTYPE html><html><head><meta charset="UTF-8"><style>html {
    margin: 0;
    padding: 0; }

body {
    background-color: white;
    border-radius: 3px;
    border: 3px solid #EEE;
    box-shadow: inset 0 0 0 1px #CECECE;
    font-family: Helvetica,arial,sans-serif;
    font-size: 14px;
    line-height: 1.6;
    width: 975px;
    padding: 30px;
    margin: 2em auto; }

body > *:first-child {
  margin-top: 0 !important; }
body > *:last-child {
  margin-bottom: 0 !important; }

a {
  color: #4183C4;
  text-decoration: none; }
a:hover {
  text-decoration: underline; }
a.absent {
  color: #cc0000; }
a.anchor {
  display: block;
  padding-left: 30px;
  margin-left: -30px;
  cursor: pointer;
  position: absolute;
  top: 0;
  left: 0;
  bottom: 0; }

h1, h2, h3, h4, h5, h6 {
  margin: 20px 0 10px;
  padding: 0;
  font-weight: bold;
  -webkit-font-smoothing: antialiased;
  cursor: text;
  position: relative; }

h1:hover a.anchor, h2:hover a.anchor, h3:hover a.anchor, h4:hover a.anchor, h5:hover a.anchor, h6:hover a.anchor {
  background: url("../../images/modules/styleguide/para.png") no-repeat 10px center;
  text-decoration: none; }

h1 tt, h1 code {
  font-size: inherit; }

h2 tt, h2 code {
  font-size: inherit; }

h3 tt, h3 code {
  font-size: inherit; }

h4 tt, h4 code {
  font-size: inherit; }

h5 tt, h5 code {
  font-size: inherit; }

h6 tt, h6 code {
  font-size: inherit; }

h1 {
  font-size: 28px;
  color: black; }

h2 {
  font-size: 24px;
  border-bottom: 1px solid #cccccc;
  color: black; }

h3 {
  font-size: 18px; }

h4 {
  font-size: 16px; }

h5 {
  font-size: 14px; }

h6 {
  color: #777777;
  font-size: 14px; }

p, blockquote, ul, ol, dl, li, table, pre {
  margin: 15px 0; }

hr {
  background: transparent url("https://a248.e.akamai.net/assets.github.com/assets/primer/markdown/dirty-shade-0e7d81b119cc9beae17b0c98093d121fa0050a74.png") repeat-x 0 0;
  border: 0 none;
  color: #ccc;
  height: 4px;
  padding: 0; }

body > h2:first-child {
  margin-top: 0;
  padding-top: 0; }
body > h1:first-child {
  margin-top: 0;
  padding-top: 0; }
  body > h1:first-child + h2 {
    margin-top: 0;
    padding-top: 0; }
body > h3:first-child, body > h4:first-child, body > h5:first-child, body > h6:first-child {
  margin-top: 0;
  padding-top: 0; }

a:first-child h1, a:first-child h2, a:first-child h3, a:first-child h4, a:first-child h5, a:first-child h6 {
  margin-top: 0;
  padding-top: 0; }

h1 p, h2 p, h3 p, h4 p, h5 p, h6 p {
  margin-top: 0; }

li p.first {
  display: inline-block; }

ul, ol {
  padding-left: 30px; }

ul li {
  margin: 5px 0;
}

ul :first-child, ol :first-child {
  margin-top: 0; }

ul :last-child, ol :last-child {
  margin-bottom: 0; }

dl {
  padding: 0; }
  dl dt {
    font-size: 14px;
    font-weight: bold;
    font-style: italic;
    padding: 0;
    margin: 15px 0 5px; }
    dl dt:first-child {
      padding: 0; }
    dl dt > :first-child {
      margin-top: 0; }
    dl dt > :last-child {
      margin-bottom: 0; }
  dl dd {
    margin: 0 0 15px;
    padding: 0 15px; }
    dl dd > :first-child {
      margin-top: 0; }
    dl dd > :last-child {
      margin-bottom: 0; }

blockquote {
  border-left: 4px solid #dddddd;
  padding: 0 15px;
  color: #777777; }
  blockquote > :first-child {
    margin-top: 0; }
  blockquote > :last-child {
    margin-bottom: 0; }

table {
  border-collapse: collapse; border-spacing: 0; padding: 0; }
  table tr {
    border-top: 1px solid #cccccc;
    background-color: white;
    margin: 0;
    padding: 0; }
    table tr:nth-child(2n) {
      background-color: #f8f8f8; }
    table tr th {
      font-weight: bold;
      border: 1px solid #cccccc;
      text-align: left;
      margin: 0;
      padding: 6px 13px; }
    table tr td {
      border: 1px solid #cccccc;
      text-align: left;
      margin: 0;
      padding: 6px 13px; }
    table tr th :first-child, table tr td :first-child {
      margin-top: 0; }
    table tr th :last-child, table tr td :last-child {
      margin-bottom: 0; }

img {
  max-width: 100%; }

span.frame {
  display: block;
  overflow: hidden; }
  span.frame > span {
    border: 1px solid #dddddd;
    display: block;
    float: left;
    overflow: hidden;
    margin: 13px 0 0;
    padding: 7px;
    width: auto; }
  span.frame span img {
    display: block;
    float: left; }
  span.frame span span {
    clear: both;
    color: #333333;
    display: block;
    padding: 5px 0 0; }
span.align-center {
  display: block;
  overflow: hidden;
  clear: both; }
  span.align-center > span {
    display: block;
    overflow: hidden;
    margin: 13px auto 0;
    text-align: center; }
  span.align-center span img {
    margin: 0 auto;
    text-align: center; }
span.align-right {
  display: block;
  overflow: hidden;
  clear: both; }
  span.align-right > span {
    display: block;
    overflow: hidden;
    margin: 13px 0 0;
    text-align: right; }
  span.align-right span img {
    margin: 0;
    text-align: right; }
span.float-left {
  display: block;
  margin-right: 13px;
  overflow: hidden;
  float: left; }
  span.float-left span {
    margin: 13px 0 0; }
span.float-right {
  display: block;
  margin-left: 13px;
  overflow: hidden;
  float: right; }
  span.float-right > span {
    display: block;
    overflow: hidden;
    margin: 13px auto 0;
    text-align: right; }

code, tt {
  margin: 0 2px;
  padding: 0 5px;
  white-space: nowrap;
  border: 1px solid #eaeaea;
  background-color: #f8f8f8;
  border-radius: 3px; }

pre code {
  margin: 0;
  padding: 0;
  white-space: pre;
  border: none;
  background: transparent; }

.highlight pre {
  background-color: #f8f8f8;
  border: 1px solid #cccccc;
  font-size: 13px;
  line-height: 19px;
  overflow: auto;
  padding: 6px 10px;
  border-radius: 3px; }

pre {
  background-color: #f8f8f8;
  border: 1px solid #cccccc;
  font-size: 13px;
  line-height: 19px;
  overflow: auto;
  padding: 6px 10px;
  border-radius: 3px; }
  pre code, pre tt {
    background-color: transparent;
    border: none; }


.markdown-body code,.markdown-body tt{margin:0 2px;padding:0px 5px;white-space:nowrap;border:1px solid #eaeaea;background-color:#f8f8f8;border-radius:3px}
.markdown-body pre>code{margin:0;padding:0;white-space:pre;border:none;background:transparent}
.markdown-body .highlight pre,.markdown-body pre{background-color:#f8f8f8;border:1px solid #ccc;font-size:13px;line-height:19px;overflow:auto;padding:6px 10px;border-radius:3px}
.markdown-body pre code,.markdown-body pre tt{background-color:transparent;border:none}
.highlight{background:#ffffff}
.highlight .c{color:#999988;font-style:italic}
.highlight .err{color:#a61717;background-color:#e3d2d2}
.highlight .k{font-weight:bold}
.highlight .o{font-weight:bold}
.highlight .cm{color:#999988;font-style:italic}
.highlight .cp{color:#999999;font-weight:bold}
.highlight .c1{color:#999988;font-style:italic}
.highlight .cs{color:#999999;font-weight:bold;font-style:italic}
.highlight .gd{color:#000000;background-color:#ffdddd}
.highlight .gd .x{color:#000000;background-color:#ffaaaa}
.highlight .ge{font-style:italic}
.highlight .gr{color:#aa0000}
.highlight .gh{color:#999999}
.highlight .gi{color:#000000;background-color:#ddffdd}
.highlight .gi .x{color:#000000;background-color:#aaffaa}
.highlight .go{color:#888888}
.highlight .gp{color:#555555}
.highlight .gs{font-weight:bold}
.highlight .gu{color:#800080;font-weight:bold}
.highlight .gt{color:#aa0000}
.highlight .kc{font-weight:bold}
.highlight .kd{font-weight:bold}
.highlight .kn{font-weight:bold}
.highlight .kp{font-weight:bold}
.highlight .kr{font-weight:bold}
.highlight .kt{color:#445588;font-weight:bold}
.highlight .m{color:#009999}
.highlight .s{color:#d14}
.highlight .na{color:#008080}
.highlight .nb{color:#0086B3}
.highlight .nc{color:#445588;font-weight:bold}
.highlight .no{color:#008080}
.highlight .ni{color:#800080}
.highlight .ne{color:#990000;font-weight:bold}
.highlight .nf{color:#990000;font-weight:bold}
.highlight .nn{color:#555555}
.highlight .nt{color:#000080}
.highlight .nv{color:#008080}
.highlight .ow{font-weight:bold}
.highlight .w{color:#bbbbbb}
.highlight .mf{color:#009999}
.highlight .mh{color:#009999}
.highlight .mi{color:#009999}
.highlight .mo{color:#009999}
.highlight .sb{color:#d14}
.highlight .sc{color:#d14}
.highlight .sd{color:#d14}
.highlight .s2{color:#d14}
.highlight .se{color:#d14}
.highlight .sh{color:#d14}
.highlight .si{color:#d14}
.highlight .sx{color:#d14}
.highlight .sr{color:#009926}
.highlight .s1{color:#d14}
.highlight .ss{color:#990073}
.highlight .bp{color:#999999}
.highlight .vc{color:#008080}
.highlight .vg{color:#008080}
.highlight .vi{color:#008080}
.highlight .il{color:#009999}
.highlight .gc{color:#999;background-color:#EAF2F5}
.type-csharp .highlight .k{color:#0000FF}
.type-csharp .highlight .kt{color:#0000FF}
.type-csharp .highlight .nf{color:#000000;font-weight:normal}
.type-csharp .highlight .nc{color:#2B91AF}
.type-csharp .highlight .nn{color:#000000}
.type-csharp .highlight .s{color:#A31515}
.type-csharp .highlight .sc{color:#A31515}


</style></head><body><h1>
<a name="mozu-javascript-sdk" class="anchor" href="#mozu-javascript-sdk"><span class="mini-icon mini-icon-link"></span></a>Mozu JavaScript SDK</h1>

<p>The Mozu JavaScript SDK is a JavaScript tool for using the Mozu APIs. It turns the simple JSON responses of the APIs into rich JavaScript objects that stay synchronized with your Mozu store, taking care of all of the AJAX, events, and callback management along the way. You can use the SDK to create innovative Mozu-powered interfaces, to integrate ecommerce features into another site, or just to make a clean Mozu theme, where all you have to worry about is the spit and polish. The SDK takes code that used to look like this:</p>

<div class="highlight"><pre><span class="nx">$</span><span class="p">.</span><span class="nx">ajax</span><span class="p">({</span>
    <span class="nx">url</span><span class="o">:</span> <span class="s1">'http://mozu/mozu.ProductRuntime.WebApi/products/'</span> <span class="o">+</span> <span class="nx">productid</span><span class="p">,</span>
    <span class="nx">headers</span><span class="o">:</span> <span class="p">{</span>
        <span class="s1">'x-vol-tenant'</span><span class="o">:</span> <span class="mi">30001</span><span class="p">,</span>
        <span class="s1">'x-vol-site'</span><span class="o">:</span> <span class="mi">2</span><span class="p">,</span>
        <span class="s1">'x-vol-sitegroup'</span><span class="o">:</span> <span class="mi">1</span>
    <span class="p">},</span>
    <span class="nx">success</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">product</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">$</span><span class="p">.</span><span class="nx">ajax</span><span class="p">({</span>
            <span class="nx">url</span><span class="o">:</span> <span class="s1">'http://mozu/mozu.CommerceRuntime.WebApi/carts/current'</span><span class="p">,</span>
            <span class="nx">type</span><span class="o">:</span> <span class="s1">'POST'</span><span class="p">,</span>
            <span class="nx">data</span><span class="o">:</span> <span class="p">{},</span>
            <span class="nx">success</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
                <span class="nx">$</span><span class="p">.</span><span class="nx">ajax</span><span class="p">({</span>
                    <span class="c1">// and so forth</span>
                <span class="p">})</span>
            <span class="p">}</span>
        <span class="p">})</span>
    <span class="p">}</span>
<span class="p">})</span>
</pre></div>

<p>And turns it into this:</p>

<div class="highlight"><pre><span class="nx">Mozu</span><span class="p">.</span><span class="nx">Tenant</span><span class="p">(</span><span class="mi">30001</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">MasterCatalog</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">Site</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">api</span><span class="p">()</span>
    <span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">'product'</span><span class="p">,</span><span class="nx">productid</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">product</span><span class="p">){</span> 
        <span class="k">return</span> <span class="nx">product</span><span class="p">.</span><span class="nx">action</span><span class="p">(</span><span class="s1">'addToCart'</span><span class="p">);</span> 
    <span class="p">}).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
        <span class="c1">// there, isn't that nice?</span>
    <span class="p">})</span>
</pre></div>

<p>It is a small (9.2Kb minified and gzipped), cross-browser, platform-independent library, that depends on no other libraries, but works well with all of the ones we know about. It supports multiple tenants and stores at once. It uses an emerging standard for asynchronous tasks called <a href="http://wiki.commonjs.org/wiki/Promises/A">Promises</a>, used also in jQuery's <a href="http://api.jquery.com/category/deferred-object/">Deferred Objects</a>. Any SDK method or function that requires an AJAX call returns a Promise object with a <code>.then</code> method for attaching callbacks to the eventual result of that AJAX call. Lastly, it looks and feels great; common ecommerce tasks can be written in an expressive, concise way, easy to follow for later maintainers of your code. <strong>It's the bee's knees on the cat's pajamas</strong>, is what we're trying to get across here. Don't talk to the Mozu APIs without it.</p>

<h2>
<a name="getting-started" class="anchor" href="#getting-started"><span class="mini-icon mini-icon-link"></span></a>Getting Started</h2>

<h3>
<a name="loading-the-sdk" class="anchor" href="#loading-the-sdk"><span class="mini-icon mini-icon-link"></span></a>Loading the SDK</h3>

<p>The SDK is available at a special URL at your store's domain: <code>yourstoredomain.com/sdk/default.js</code>. Two other flavors are available: a minified version at <code>yourstoredomain.com/sdk/min.js</code>, and a debug version that exposes some inner workings at <code>yourstoredomain.com/sdk/debug.js</code>. <strong>We recommend using the minified version.</strong> The simplest way to include the SDK is with a good old-fashioned <code>script</code> tag:</p>

<div class="highlight"><pre><span class="nt">&lt;script </span><span class="na">src=</span><span class="s">"/sdk/min.js"</span><span class="nt">&gt;&lt;/script&gt;</span>
</pre></div>

<p>You will then be able to make new API contexts using the <code>Mozu</code> global variable.</p>

<p>Of course, <strong>our favorite way to load the SDK is with <em>require.js</em>.</strong> The Core Theme uses RequireJS modules for all its JavaScript, and our template language provides convenience methods to make RequireJS modules easy and seamless to use; our SDK is compatible with RequireJS as well!</p>

<div class="highlight"><pre><span class="nx">require</span><span class="p">([</span><span class="s1">'sdk'</span><span class="p">],</span> <span class="kd">function</span><span class="p">(</span><span class="nx">Mozu</span><span class="p">)</span> <span class="p">{</span>
   <span class="kd">var</span> <span class="nx">api</span> <span class="o">=</span> <span class="nx">Mozu</span><span class="p">.</span><span class="nx">Store</span><span class="p">(</span><span class="s1">'...'</span><span class="p">).</span><span class="nx">api</span><span class="p">();</span>
   <span class="c1">// In the presence of a global, AMD-compatible define() function,</span>
   <span class="c1">// the SDK will define() itself instead of assigning itself to the Mozu global. </span>
<span class="p">});</span>
</pre></div>

<h3>
<a name="obtaining-an-api-interface" class="anchor" href="#obtaining-an-api-interface"><span class="mini-icon mini-icon-link"></span></a>Obtaining an API Interface</h3>

<p><em><strong>Note:</strong> The Core Theme includes a module, <code>modules/api</code>, that completes this step for you. It initializes an API interface and returns it to you prepared to create API objects. Use this part of the guide for initializing the SDK outside your Core theme or its descendents.</em></p>

<p>The SDK tries to be as simple as possible, but since Mozu is a multi-tenant system at its core, you have to provide your tenant, sitegroup, and site IDs before you get an API interface. The combination of variables that determine your store and authentication level is called a <strong>context</strong>. The first thing to do is obtain one.</p>

<p>You can create a context by chaining individual functions:</p>

<div class="highlight"><pre><span class="kd">var</span> <span class="nx">context</span> <span class="o">=</span> <span class="nx">Mozu</span><span class="p">.</span><span class="nx">Tenant</span><span class="p">(</span><span class="mi">30001</span><span class="p">).</span><span class="nx">MasterCatalog</span><span class="p">(</span><span class="mi">1</span><span class="p">).</span><span class="nx">Site</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>
</pre></div>

<p>Or you can call the single <code>Store()</code> method with an object literal of these IDs:</p>

<div class="highlight"><pre><span class="kd">var</span> <span class="nx">context</span> <span class="o">=</span> <span class="nx">Mozu</span><span class="p">.</span><span class="nx">Store</span><span class="p">({</span>
    <span class="s1">'tenant'</span><span class="o">:</span> <span class="mi">30001</span><span class="p">,</span>
    <span class="s1">'site-group'</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
    <span class="s1">'site'</span><span class="o">:</span> <span class="mi">2</span>   
<span class="p">});</span>
</pre></div>

<p>These two script blocks are equivalent. They both produce the same context object.</p>

<p>Contexts can be used to create new contexts:</p>

<div class="highlight"><pre><span class="kd">var</span> <span class="nx">context</span> <span class="o">=</span> <span class="nx">Mozu</span><span class="p">.</span><span class="nx">Tenant</span><span class="p">(</span><span class="mi">30001</span><span class="p">).</span><span class="nx">MasterCatalog</span><span class="p">(</span><span class="mi">1</span><span class="p">).</span><span class="nx">Site</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">site3Context</span> <span class="o">=</span> <span class="nx">context</span><span class="p">.</span><span class="nx">Site</span><span class="p">(</span><span class="mi">3</span><span class="p">);</span>
<span class="c1">// the new site3Context is still in tenant 30001 and sitegroup 1</span>
</pre></div>

<p>But the <em>big</em> deal about a context is that once it has a tenant, sitegroup, and site, it can produce an <strong>interface object</strong> through its <code>.api()</code> method.</p>

<div class="highlight"><pre><span class="kd">var</span> <span class="nx">myStoreApi</span> <span class="o">=</span> <span class="nx">Mozu</span><span class="p">.</span><span class="nx">Tenant</span><span class="p">(</span><span class="mi">30001</span><span class="p">).</span><span class="nx">MasterCatalog</span><span class="p">(</span><span class="mi">1</span><span class="p">).</span><span class="nx">Site</span><span class="p">(</span><span class="mi">2</span><span class="p">).</span><span class="nx">api</span><span class="p">();</span>
</pre></div>

<p>This interface is what you'll use to work with API objects.</p>

<h3>
<a name="getting-objects-with-your-interface" class="anchor" href="#getting-objects-with-your-interface"><span class="mini-icon mini-icon-link"></span></a>Getting Objects With Your Interface</h3>

<h4>
<a name="using-get-create-update-and-del" class="anchor" href="#using-get-create-update-and-del"><span class="mini-icon mini-icon-link"></span></a>Using <code>.get()</code>, <code>.create()</code>, <code>.update()</code>, and <code>.del()</code>
</h4>

<p>You might recognize that these methods correspond to the standard set of CRUD actions available on REST API resources! Or, if you're not a REST junkie, you might see them as likely things you'd want to do with API objects. These are the basic methods you'll use to get started. API objects have similar methods on themselves, so you should view these methods on the interface itself as being <em>starting points</em> for a chain of interactions. <strong>By far, the most common starting point is <code>.get()</code>, so that's what we'll cover here;</strong> the other methods take the same arguments.</p>

<p>Let's assume we created an interface that we called <code>myStoreApi</code>, as above, and use it to get a product:</p>

<div class="highlight"><pre><span class="kd">var</span> <span class="nx">productPromise</span> <span class="o">=</span> <span class="nx">myStoreApi</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">'product'</span><span class="p">,{</span>
    <span class="nx">ProductCode</span><span class="o">:</span> <span class="s1">'OXFORDSHIRT1'</span>
<span class="p">});</span>
</pre></div>

<p>The first argument to <code>.get()</code> is the <strong>object type</strong> you want. This must be a string such as <code>"product"</code>, <code>"cart"</code>, or <code>"user"</code>. The complete list of supported product types is available in the full SDK documentation.</p>

<p>The second argument to <code>.get()</code> is the <strong>request configuration</strong>. This is an object literal, specifying the part of the object that you already know about. In this case, we want to get a product when we know its code.
<strong>Note:</strong> For many objects, you'll find yourself searching on one parameter most commonly. Products, for example, you'll usually get using their unique product code. The SDK gives you some sugar here.</p>

<div class="highlight"><pre><span class="c1">// the below is equivalent to the above; the SDK knows that a string for a product request config means to use that string as ProductCode.</span>
<span class="kd">var</span> <span class="nx">productPromise</span> <span class="o">=</span> <span class="nx">myStoreApi</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">'product'</span><span class="p">,</span><span class="s1">'OXFORDSHIRT1'</span><span class="p">);</span>
</pre></div>

<h4>
<a name="working-with-promises" class="anchor" href="#working-with-promises"><span class="mini-icon mini-icon-link"></span></a>Working with Promises</h4>

<p>You might notice that we are storing the return value of <code>myStoreApi.get()</code> in a variable called <code>productPromise</code>. Why <code>productPromise</code> and not just <code>product</code>? Because when the method returns, the product isn't quite ready yet; the <code>.get()</code> method, like all asynchronous methods in the SDK, returns a <strong>Promise</strong>. The SDK needs to run an AJAX call to retrieve this product, so it returns an object that you can add callbacks to, via its <code>.then()</code> method.</p>

<div class="highlight"><pre><span class="nx">productPromise</span><span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">product</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">product</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">ProductName</span><span class="p">);</span> <span class="c1">// --&gt; 'Oxford Shirt'</span>
<span class="p">})</span>
</pre></div>

<p>You can usually chain the api request and the call to <code>.then()</code> for brevity and readability, and the promise itself never gets stored in a variable:</p>

<div class="highlight"><pre><span class="nx">myStoreApi</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">'product'</span><span class="p">,</span><span class="s1">'OXFORDSHIRT1'</span><span class="p">).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">product</span><span class="p">){</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">product</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">ProductName</span><span class="p">);</span> <span class="c1">// --&gt; 'Oxford Shirt'</span>
<span class="p">});</span>
</pre></div>

<p>The <code>.then()</code> method takes <em>two</em> arguments; the first is called if the promise <em>fulfilled</em>, and the second if the promise <em>rejected</em>. In SDK terms, this translates to whether your API call was successful or not. The second argument to <code>.then()</code> can be used for error handling:</p>

<div class="highlight"><pre><span class="nx">myStoreApi</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">'product'</span><span class="p">,</span><span class="s1">'OXFORDSHIRT1'</span><span class="p">).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">product</span><span class="p">){</span>
    <span class="k">return</span> <span class="nx">product</span><span class="p">.</span><span class="nx">action</span><span class="p">(</span><span class="s1">'addToCart'</span><span class="p">);</span>
<span class="p">},</span> <span class="kd">function</span><span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="nx">error</span><span class="p">);</span>
<span class="p">})</span>
</pre></div>

<p>Remember that a Promise can take indefinite callbacks; you can call .then() on it as many times as you want and add success and/or failure handlers that receive its eventual result.</p>

<h4>
<a name="chaining-promises" class="anchor" href="#chaining-promises"><span class="mini-icon mini-icon-link"></span></a>Chaining Promises</h4>

<p>If you're wondering why Promises are any better than just having success and failure callbacks, then read this carefully, because this is the special sauce.</p>

<p>The <code>.then()</code> method of a promise <strong>returns a new promise</strong>. The new promise fulfills or rejects with the <em>return value</em> of the handlers you added during that invocation of <code>.then()</code>.</p>

<div class="highlight"><pre><span class="kd">var</span> <span class="nx">newPromise</span> <span class="o">=</span> <span class="nx">myStoreApi</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">'product'</span><span class="p">,</span><span class="s1">'OXFORDSHIRT1'</span><span class="p">).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">product</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">product</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">Price</span><span class="p">.</span><span class="nx">Price</span><span class="p">;</span>
<span class="p">});</span>
<span class="nx">newPromise</span><span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">value</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">value</span><span class="p">);</span> <span class="c1">// --&gt; 35.00</span>
<span class="p">})</span>
</pre></div>

<p>And if you return a new promise inside your old promise's <code>.then()</code> handler, you get a promise that only fulfills when both the old and the new promise have fulfilled. This makes it easy to do sequential, asynchronous tasks without building an ugly, hard-to-trace callback pyramid!</p>

<div class="highlight"><pre><span class="nx">myStoreApi</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">'product'</span><span class="p">,</span><span class="s1">'OXFORDSHIRT1'</span><span class="p">).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">product</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">product</span><span class="p">.</span><span class="nx">action</span><span class="p">(</span><span class="s1">'addToCart'</span><span class="p">);</span>
<span class="p">}).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">cartItem</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">myStoreApi</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">'cart'</span><span class="p">)</span>
<span class="p">}).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">cart</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">cart</span><span class="p">.</span><span class="nx">action</span><span class="p">(</span><span class="s1">'checkout'</span><span class="p">);</span>
<span class="p">})</span>
</pre></div>

<p>Isn't that nice? The interface has a few convenience methods to make multiple promises even easier to manage, available in the full SDK documentation.</p>

<h4>
<a name="the-raw-request-method" class="anchor" href="#the-raw-request-method"><span class="mini-icon mini-icon-link"></span></a>The raw <code>request()</code> method</h4>

<p>The API exposes a <code>request()</code> method that you can use to perform raw AJAX calls to URLs that you manually specify. Like all asynchronous methods, it returns a Promise with a <code>.then()</code> method, but the promise fulfills with a raw JSON object instead of a rich API object.</p>

<div class="highlight"><pre><span class="nx">api</span><span class="p">.</span><span class="nx">request</span><span class="p">(</span><span class="s1">'GET'</span><span class="p">,</span><span class="s1">'http://mozu/mozu.CommerceRuntime.WebApi/carts/current'</span><span class="p">).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">cartData</span><span class="p">){</span>
    <span class="c1">// cartData is raw JSON here</span>
<span class="p">})</span>
</pre></div>

<p>You should never have to do this, since all the calls you'll want to make should be supported by the SDK's library of rich objects. If you find yourself doing this, either we've dropped the ball, or there might be a cleaner and more concise way to do what you're trying to do.</p>

<h3>
<a name="using-api-objects" class="anchor" href="#using-api-objects"><span class="mini-icon mini-icon-link"></span></a>Using API Objects</h3>

<p>Now that you're using the interface's <code>.get()</code> method (or <code>.create()</code> or <code>.update()</code> methods, you hotshot) to acquire API objects, you may have noticed some stuff about them:</p>

<ul>
<li> They have a <code>type</code> property, a string representing their type (e.g. <code>"product"</code> or <code>"user"</code>)</li>
<li> They have a <code>data</code> property, an object containing the raw JSON representation of this API resource</li>
<li> They have an <code>.action()</code> method</li>
<li> They have a <code>.getAvailableActions()</code> method</li>
<li> They have <code>.on()</code>, <code>.off()</code>, and <code>.fire()</code> methods</li>
</ul><p>The <code>.action()</code> method on API objects is where, not coincidentally, the action is. Every API object has a list of <strong>actions</strong> you can perform on it. Some actions transform the object, some use it to create a new object, some get related objects. You can see what your API object can do by running <code>.getAvailableActions()</code> on it, which will return an array of strings.</p>

<div class="highlight"><pre><span class="nx">api</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">'product'</span><span class="p">,</span><span class="s1">'OXFORDSHIRT1'</span><span class="p">).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">product</span><span class="p">){</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">product</span><span class="p">.</span><span class="nx">getAvailableActions</span><span class="p">());</span> <span class="c1">// --&gt; ["update", "create", "del", "get", "addToCart"]</span>
<span class="p">})</span>
</pre></div>

<p>You can carry out any of these actions on your product using the <code>.action()</code> method. All API objects have the four basic actions, which are usually the equivalent of using the API interface's method instead of the API object's method. Most API objects have more specialized actions, such as <code>addToCart</code>.</p>

<p>Since the <code>.action</code> method always has to run an AJAX call, it returns a Promise. For many actions, the promise will fulfill with the same (updated) object; for others, the promise will fulfill with a new or different object. In the case of <code>addToCart</code>, the returned object is a CartItem.</p>

<div class="highlight"><pre><span class="nx">product</span><span class="p">.</span><span class="nx">action</span><span class="p">(</span><span class="s1">'addToCart'</span><span class="p">,</span> <span class="mi">3</span><span class="p">).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">cartItem</span><span class="p">){</span>
    <span class="k">return</span> <span class="nx">cartItem</span><span class="p">.</span><span class="nx">action</span><span class="p">(</span><span class="s1">'updateQuantity'</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
<span class="p">})</span>
<span class="c1">// the above adds 3 of a product to the cart, and then updates the quantity to 2, removing one.</span>
<span class="c1">// Goodness knows why, but it seemed instructive</span>
</pre></div>

<p>Using Promises and Actions, you can build a very clear chain of events with the SDK:</p>

<div class="highlight"><pre><span class="nx">api</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">'product'</span><span class="p">,</span><span class="s1">'OXFORDSHIRT1'</span><span class="p">).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">product</span><span class="p">){</span>
    <span class="k">return</span> <span class="nx">product</span><span class="p">.</span><span class="nx">action</span><span class="p">(</span><span class="s1">'addToCart'</span><span class="p">,</span><span class="mi">3</span><span class="p">);</span>
<span class="p">}).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
    <span class="k">return</span> <span class="nx">api</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">'cart'</span><span class="p">);</span>
<span class="p">}).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">cart</span><span class="p">){</span>
    <span class="k">return</span> <span class="nx">cart</span><span class="p">.</span><span class="nx">checkout</span><span class="p">();</span>
<span class="p">}).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">order</span><span class="p">)</span> <span class="p">{</span>
    <span class="nb">window</span><span class="p">.</span><span class="nx">location</span> <span class="o">=</span> <span class="s2">"/orders/"</span> <span class="o">+</span> <span class="nx">order</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">Id</span><span class="p">;</span>
<span class="p">});</span>
</pre></div>

<h3>
<a name="using-events" class="anchor" href="#using-events"><span class="mini-icon mini-icon-link"></span></a>Using Events</h3>

<p>Both the API interface and the API objects fire events. They have <code>.on()</code> and <code>.off()</code> methods that each take two arguments: an event name, and a function or function reference to use as a handler. There is also a <code>.fire()</code> event on both, to manually fire these events if necessary.</p>

<h4>
<a name="events-on-the-api-interface" class="anchor" href="#events-on-the-api-interface"><span class="mini-icon mini-icon-link"></span></a>Events on the API Interface</h4>

<p>The API interface throws three events: <code>request</code>, <code>success</code>, and <code>error</code>. The <code>request</code> event fires before every AJAX request the interface makes, including requests made by the interface's child objects. <em>(Under the hood, all API objects use their parent interface to issue their requests.)</em> The <code>success</code> event fires after an AJAX request has successfully completed, but before any promises are fulfilled. The <code>error</code> event fires after an AJAX request has failed, either from a failed HTTP request or from the API service responding with a detailed error. You can use the interface's events for e.g. a global error handler, instead of having to argue the same error handlers into every promise:</p>

<div class="highlight"><pre><span class="nx">api</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">'error'</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">error</span><span class="p">){</span>
    <span class="kd">var</span> <span class="nx">messages</span> <span class="o">=</span> <span class="nx">error</span><span class="p">.</span><span class="nx">Items</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">item</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">item</span><span class="p">.</span><span class="nx">Message</span><span class="p">;</span> <span class="p">}).</span><span class="nx">join</span><span class="p">(</span><span class="s1">'\n'</span><span class="p">);</span>
    <span class="nx">alert</span><span class="p">(</span><span class="s2">"Sorry, errors occurred in the Mozu API: \n"</span> <span class="o">+</span> <span class="nx">messages</span><span class="p">);</span>
<span class="p">})</span>
</pre></div>

<h4>
<a name="events-on-the-api-object" class="anchor" href="#events-on-the-api-object"><span class="mini-icon mini-icon-link"></span></a>Events on the API Object</h4>

<p>API objects throw four events: <code>action</code>, <code>sync</code>, <code>spawn</code>, and <code>error</code>. The <code>action</code> event fires before every action request is sent, and the <code>error</code> event fires if any of this object's requests fail, but instead of a <code>success</code> event, there are two different success cases:</p>

<ul>
<li>  <code>sync</code> fires if the action caused an update in <em>this object's</em> data, like a <code>get</code> or an <code>update</code> action</li>
<li>
<p><code>spawn</code> fires if the action caused a new API object to be returned by the fulfilled promise, like <code>addToCart</code> returning a <code>"cartitem"</code> from a <code>"product"</code>, or <code>checkout</code> returning an <code>"order"</code> from a <code>"cart"</code>.</p>

<p>Subscribe to the events in the same way as the interface. These events are useful when integrating the SDK objects into some client-side data-binding framework.</p>
</li>
</ul><div class="highlight"><pre><span class="nx">product</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">'action'</span><span class="p">,</span> <span class="kd">function</span><span class="p">(){</span>
    <span class="nx">myProductView</span><span class="p">.</span><span class="nx">addClass</span><span class="p">(</span><span class="s1">'loading'</span><span class="p">);</span>
<span class="p">})</span>
<span class="nx">product</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">'sync'</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">newData</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">myProductView</span><span class="p">.</span><span class="nx">removeClass</span><span class="p">(</span><span class="s1">'loading'</span><span class="p">);</span>
    <span class="nx">myProductViewModel</span><span class="p">.</span><span class="nx">update</span><span class="p">(</span><span class="nx">newData</span><span class="p">);</span>
<span class="p">})</span>
</pre></div>

<h3>
<a name="get-going" class="anchor" href="#get-going"><span class="mini-icon mini-icon-link"></span></a>Get Going</h3>

<p>This guide has outlined the most commonly used features of the SDK; it should be enough to get you started with your killer new Mozu app. If it's not, there is full SDK documentation after the beep!</p>

<h2>
<a name="full-sdk-reference" class="anchor" href="#full-sdk-reference"><span class="mini-icon mini-icon-link"></span></a>Full SDK Reference</h2>

<ul>
<li>  <em>There is no full SDK documentation yet.</em>
</li>
</ul></body></html>